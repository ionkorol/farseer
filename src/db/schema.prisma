generator client {
  provider = "prisma-client"
  output   = "./generated/client"
  runtime  = "bun"
}

datasource db {
  provider = "postgresql"
}

enum SearchRequestStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED
}

enum Supplier {
  VAX
}

model SearchRequest {
  id              String              @id @default(cuid())
  searchKey       String
  suppliers       Supplier[]
  // Search parameters
  origin          String
  destination     String
  checkIn         DateTime
  checkOut        DateTime
  rooms           Int
  adultsPerRoom   String // JSON array: [2,2]
  childrenPerRoom String // JSON array: [0,0]
  childAges       String // JSON array: [[],[]]
  // Status tracking
  status          SearchRequestStatus @default(PENDING)
  progress        String? // Progress message (e.g., "Searching vendor 2 of 5...")
  error           String? // Error message if failed
  hotels          Hotel[]
  // Metadata
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  @@index([status])
  @@index([createdAt])
}

model Hotel {
  id                  String        @id @default(cuid())
  // Hotel identification
  supplier            Supplier
  supplierHotelId     String
  // Hotel details
  name                String
  remoteSource        String
  destinationCode     String
  rating              Float
  tripAdvisorRating   Float?
  tripAdvisorReviews  Int?
  location            String
  distanceFromAirport Float?
  cleaningBadge       String?
  // Search parameters (denormalized for easier querying)
  checkIn             DateTime
  checkOut            DateTime
  // Metadata
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  // Relations
  rooms               Room[]
  searchRequestId     String
  searchRequest       SearchRequest @relation(fields: [searchRequestId], references: [id], onDelete: Cascade)

  @@index([supplierHotelId, supplier])
  @@index([rating])
  @@index([name])
}

model Room {
  id              String   @id @default(cuid())
  // Room identification
  code            String
  name            String
  // Pricing
  totalPrice      Decimal
  pricePerPerson  Decimal?
  // Additional features
  addedValues     String[]
  valueIndicators String[]
  // Metadata
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  // Relations
  hotelId         String
  hotel           Hotel    @relation(fields: [hotelId], references: [id], onDelete: Cascade)

  @@index([hotelId])
  @@index([totalPrice])
}
